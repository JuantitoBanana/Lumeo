spring.application.name=lumeo

# Configurar servidor para escuchar en todas las interfaces
server.address=0.0.0.0
server.port=${PORT:8080}

# Configuración de base de datos usando variables de entorno
spring.datasource.url=${DATABASE_URL:jdbc:postgresql://localhost:5432/postgres}
spring.datasource.username=${DATABASE_USERNAME:postgres}
spring.datasource.password=${DATABASE_PASSWORD:password}
spring.datasource.driver-class-name=org.postgresql.Driver

# Hibernate Configuration - Optimizado para Supabase Transaction Pooler
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.properties.hibernate.use_sql_comments=false
# Batch reducido para Transaction Pooler
spring.jpa.properties.hibernate.jdbc.batch_size=10
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
# CRÍTICO: Desactivar prepared statement cache con Transaction Pooler
spring.jpa.properties.hibernate.query.plan_cache_max_size=64
spring.jpa.properties.hibernate.query.plan_parameter_metadata_max_size=32

# Connection pool settings - OPTIMIZADO para Supabase Session Pooler (PgBouncer)
# Session Pooler tiene 15 conexiones dedicadas - podemos usar más
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.minimum-idle=2
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.validation-timeout=5000
# Lifecycle: Session Pooler mantiene estado
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.keepalive-time=60000
spring.datasource.hikari.leak-detection-threshold=60000
# Pool naming
spring.datasource.hikari.pool-name=LumeoHikariCP
# Connection test query para Session Pooler
spring.datasource.hikari.connection-test-query=SELECT 1

# Configuración para Session Pooler (Puerto 5432)
# Session Pooler SOPORTA prepared statements y mantiene estado de sesión
# Tiene 15 conexiones dedicadas por cliente - no compite con otras apps

# Configuración de transacciones - Optimizado para Session Pooler
spring.transaction.default-timeout=30
spring.jpa.properties.hibernate.connection.autocommit=true
spring.jpa.properties.hibernate.connection.provider_disables_autocommit=false
spring.jpa.properties.hibernate.jdbc.use_get_generated_keys=true

# Configuración adicional para estabilidad
spring.sql.init.continue-on-error=false
spring.jpa.open-in-view=false
# Auto-commit habilitado para Session Pooler
spring.datasource.hikari.auto-commit=true

# Actuator Health Check Configuration
management.endpoints.web.exposure.include=health
management.endpoint.health.show-details=always
management.health.defaults.enabled=true
management.health.db.enabled=true